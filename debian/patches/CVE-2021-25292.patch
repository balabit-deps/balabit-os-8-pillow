From 3bce145966374dd39ce58a6fc0083f8d1890719c Mon Sep 17 00:00:00 2001
From: Hugo van Kemenade <hugovk@users.noreply.github.com>
Date: Sat, 9 Jan 2021 15:53:09 +0200
Subject: [PATCH] Use more specific regex chars to prevent ReDoS

* CVE-2021-25292
---
 src/PIL/PdfParser.py | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/src/PIL/PdfParser.py
+++ b/src/PIL/PdfParser.py
@@ -590,8 +590,9 @@ class PdfParser:
     whitespace_or_hex = br"[\000\011\012\014\015\0400-9a-fA-F]"
     whitespace_optional = whitespace + b"*"
     whitespace_mandatory = whitespace + b"+"
+    whitespace_optional_no_nl = br"[\000\011\014\015\040]*"  # no "\012" aka "\n"
     newline_only = br"[\r\n]+"
-    newline = whitespace_optional + newline_only + whitespace_optional
+    newline = whitespace_optional_no_nl + newline_only + whitespace_optional_no_nl
     re_trailer_end = re.compile(
         whitespace_mandatory
         + br"trailer"
